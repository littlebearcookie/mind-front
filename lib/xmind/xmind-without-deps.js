!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("XMLLite"),require("window"),require("JSZip")):"function"==typeof define&&define.amd?define(["XMLLite","window","JSZip"],t):"object"==typeof exports?exports.xmind=t(require("XMLLite"),require("window"),require("JSZip")):e.xmind=t(e.XMLLite,e.window,e.JSZip)}(this,function(e,t,n){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="/",t(0)}([function(e,t,n){"use strict";var r=n(1),i=n(8),o=n(9).saveAs,u=n(10),a=n(11),s=n(13),c=n(15),l=n(17),d=n(18),f=n(25),p=n(12);r.extend(p,i),r.extend(f,{open:function(e){return f.load(e)},save:function(e,t){var n=e.dump(),r=n.generate({type:"blob"});o(r,t)}}),r.extend(f.prototype,{save:function(e){f.save(this,e)}}),e.exports={CONST:u,DomMixin:a,Legend:s,Relationship:c,Sheet:l,Topic:d,Workbook:f,open:f.open,save:f.save,utils:p}},function(e,t,n){"use strict";var r=n(2),i=n(5),o=n(4),u=n(6),a=n(7),s=n(3);e.exports=u.extend({global:i},r,o,u,a,s)},function(e,t,n){"use strict";function r(e){return"object"===("undefined"==typeof e?"undefined":l(e))&&f.isFinite(e.length)}function i(e){return r(e)?T.call(e):[]}function o(e){return T.call(e,1)}function u(e,t,n){return e.apply(t,o(n))}function a(e,t){return y(i(e),t)>-1}function s(e){var t=[];return g(e,function(e){a(t,e)||t.push(e)}),t}function c(e){for(var t=i(e),n=[],o=0,u=t.length;o<u;++o)r(t[o])?n=n.concat(t[o]):n[n.length]=t[o];return n}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=n(3),f=n(4),p=d.isArray,h=Array.prototype,T=h.slice,m=function(e){return function(t,n,r){var i=void 0,o=t.length>>>0;if(0===o)return-1;if(r?r<0&&(r=Math.max(0,t.length+r)):r=e?0:t.length,e){for(i=r;i<t.length;i++)if(t[i]===n)return i}else for(i=r;i>=0;i--)if(t[i]===n)return i;return-1}},y=h.indexOf?function(e){return u(h.indexOf,e,arguments)}:m(!0),v=h.lastIndexOf?function(e){return u(h.lastIndexOf,e,arguments)}:m(),g=h.forEach?function(e){u(h.forEach,e,arguments)}:function(e,t,n){for(var r=i(e),o=0;o<r.length;o++)t.call(n,r[o],o,e)},A=h.every?function(e){return u(h.every,e,arguments)}:function(e,t,n){for(var r=i(e),o=0;o<r.length;o++)if(!t.call(n,r[o],o,e))return!1;return!0},b=h.filter?function(e){return u(h.filter,e,arguments)}:function(e,t,n){var r=[];return g(e,function(i,o){t.call(n,i,o,e)&&r.push(i)}),r},_=h.map?function(e){return u(h.map,e,arguments)}:function(e,t,n){var r=[];return g(e,function(i,o){r.push(t.call(n,i,o,e))}),r},N=h.some?function(e){return u(h.some,e,arguments)}:function(e,t,n){var r=void 0;for(r=0;r<e.length;r++)if(t.call(n,e[r],r,e))return!0;return!1},R=h.reduce?function(e){return u(h.reduce,e,arguments)}:function(e,t,n){var r=void 0;n&&(r=n);for(var i=0;i<e.length;i++)r=r?t(r,e[i],i,e):e[i];return r},x=h.reduceRight?function(e){return u(h.reduceRight,e,arguments)}:function(e,t,n){var r=void 0;n&&(r=n);for(var i=e.length-1;i>=0;i--)r=r?t(r,e[i],i,e):e[i];return r},E={contains:a,each:g,every:A,filter:b,flatten:c,index:m,indexOf:y,isArray:p,isArrayLike:r,lastIndexOf:v,map:_,reduce:R,reduceRight:x,some:N,toArray:i,uniq:s,forEach:g,difference:function(e){var t=c(o(arguments));return b(e,function(e){return!a(t,e)})},eachReverse:function(e,t,n){for(var r=i(e),o=r.length-1;o>-1;o-=1)t.call(n,r[o],o,e)},intersect:function(e,t){var n=[];return g(e,function(e){a(t,e)&&n.push(e)}),n},range:function e(t,n,r){null==n&&(n=t||0,t=0),r||(r=n<t?-1:1);for(var i=Math.max(Math.ceil((n-t)/r),0),e=new Array(i),o=0;o<i;o++,t+=r)e[o]=t;return e},remove:function(e,t,n){var r=e.length;if(!f.isNumber(t))return e;var i=e.slice((n||t)+1||r);return e.length=t<0?r+t:t,e.push.apply(e,i)},union:function(){var e=[],t=i(arguments);return g(t,function(t){e=e.concat(t)}),s(e)}};e.exports=E},function(e,t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r={}.toString,i=function(e,t){return r.call(e)==="[object "+t+"]"},o={isType:i,isArguments:function(e){return i(e,"Arguments")},isArray:Array.isArray?Array.isArray:function(e){return i(e,"Array")},isArrayLike:function(e){return"object"===("undefined"==typeof e?"undefined":n(e))&&isFinite(e.length)},isBoolean:function(e){return i(e,"Boolean")},isDate:function(e){return i(e,"Date")},isError:function(e){return i(e,"Error")},isFunction:function(e){return i(e,"Function")},isNull:function(e){return null===e},isNumber:function(e){return i(e,"Number")},isPlainObject:function(e){return i(e,"Object")},isRegExp:function(e){return i(e,"RegExp")},isString:function(e){return i(e,"String")},isUndefined:function(e){return void 0===e},getType:function(e){var t=r.call(e);return t.replace(/^\[object /,"").replace(/\]$/,"")},isObject:function(e){var t="undefined"==typeof e?"undefined":n(e);return"function"===t||"object"===t&&!!e}};o.isNil=function(e){return o.isNull(e)||o.isUndefined(e)},e.exports=o},function(e,t,n){"use strict";var r=n(3),i=r.isNumber,o=Math.min,u=Math.max,a={isFinite:isFinite,isNaN:isNaN,isNumber:i,isDecimal:function(e){return i(e)&&e%1!==0},isEven:function(e){return i(e)&&e%2===0},isInteger:Number.isInteger?Number.isInteger:function(e){return i(e)&&e%1===0},isNegative:function(e){return i(e)&&e<0},isOdd:function(e){return i(e)&&e%2!==0},isPositive:function(e){return i(e)&&e>0},toFloat:function(e){return parseFloat(e)},toInteger:function(e,t){return parseInt(e,t||10)},isInRange:function(e,t,n){return t=+t||0,void 0===n?(n=t,t=0):n=+n||0,e>=o(t,n)&&e<u(t,n)}};a.isInFinite=function(e){return!a.isFinite(e)},e.exports=a},function(e,t){(function(t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r="undefined",i={};("undefined"==typeof window?"undefined":n(window))!==r?i=window:("undefined"==typeof t?"undefined":n(t))!==r?i=t:("undefined"==typeof self?"undefined":n(self))!==r&&(i=self),e.exports=i}).call(t,function(){return this}())},function(e,t,n){"use strict";function r(e){return f(e)?e:{}}function i(e,t,n){var i=r(e);for(var o in i)({}).hasOwnProperty.call(i,o)&&t.call(n,i[o],o,e)}function o(e){var t=[];return i(e,function(e){t.push(e)}),t}function u(e){return e=e||{},T(y(arguments).slice(1),function(t){t&&i(t,function(n,r){e[r]=t[r]})}),e}function a(e){return e=e||{},T(y(arguments).slice(1),function(t){i(t,function(n,r){c(t[r])!==c(e[r])?f(t[r])?(e[r]={},a(e[r],t[r])):e[r]=t[r]:f(t[r])?a(e[r],t[r]):e[r]=t[r]})}),e}var s=n(3),c=s.getType,l=s.isFunction,d=s.isObject,f=s.isPlainObject,p=n(2),h=p.contains,T=p.each,m=p.isArrayLike,y=p.toArray,v=Object.keys?function(e){return Object.keys(e)}:function(e){var t=[];return i(e,function(n,r){l(e)&&"prototype"===r||t.push(r)}),t},g={extend:u,forIn:i,isObject:d,isPlainObject:f,keys:v,merge:a,values:o,assign:u,hasKey:function(e,t){return{}.hasOwnProperty.call(e,t)},hasValue:function(e,t){return h(o(e),t)},invert:function(e){var t={};return i(e,function(e,n){t[e]=n}),t},clone:function(e){return m(e)?y(e):f(e)?a({},e):e},destroy:function(e){i(e,function(t,n){delete e[n]}),e.prototype=null,e=null}};e.exports=g},function(e,t,n){"use strict";function r(e){return e.toString()}var i=n(3),o=i.isString,u=String.prototype,a={isString:o,trim:function(e){return e=r(e),u.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},trimLeft:function(e){return e=r(e),u.trimLeft?e.trimLeft():e.replace(/^\s+/g,"")},trimRight:function(e){return e=r(e),u.trimRight?e.trimRight():e.replace(/^\s+/g,"")},lc:function(e){return r(e).toLowerCase()},uc:function(e){return r(e).toUpperCase()},hasSubString:function(e,t){return r(e).indexOf(r(t))>-1}};e.exports=a},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){"use strict";e.exports={ATTACHMENTS_DIR:"attachments/",ATTR_BRANCH:"branch",ATTR_DESCRIPTION:"description",ATTR_END1:"end1",ATTR_END2:"end2",ATTR_HREF:"xlink:href",ATTR_ID:"id",ATTR_MARKERID:"marker-id",ATTR_STYLE_ID:"style-id",ATTR_THEME:"theme",ATTR_TIMESTAMP:"timestamp",ATTR_TYPE:"type",ATTR_VERSION:"version",ATTR_VISIBILITY:"visibility",ATTR_X:"svg:x",ATTR_Y:"svg:y",AUTHOR:"leungwensen@gmail.com",CONTENT_XML:"content.xml",FILE_PROTOCOL:"file://",HTML_FORMAT_NOTE:"html",HTTPS_PROTOCOL:"https://",HTTP_PROTOCOL:"http://",MANIFEST_XML:"META-INF/manifest.xml",MARKERS_DIR:"markers/",MARKER_SHEET:"markers/markerSheet.xml",MARKER_SHEET_XML:"markerSheet.xml",META_INF_DIR:"META-INF/",META_XML:"meta.xml",NAMESPACE:"xmlns",NS_FO:"http://www.w3.org/1999/XSL/Format",NS_SVG:"http://www.w3.org/2000/svg",NS_URI:"http://www.w3.org/1999/xhtml",NS_XHTML:"http://www.w3.org/1999/xhtml",NS_XLINK:"http://www.w3.org/1999/xlink",PLAIN_FORMAT_NOTE:"plain",REVISIONS_DIR:"Revisions/",REVISIONS_XML:"revisions.xml",SHAPE_ELLIPSIS:"org.xmind.topicShape.ellipse",SHAPE_RECTANGLE:"org.xmind.topicShape.rectangle",SHAPE_ROUND_RECTANGLE:"org.xmind.topicShape.roundedRect",STYLES_XML:"styles.xml",TAG_CHILDREN:"children",TAG_LABEL:"label",TAG_LABELS:"labels",TAG_LEGEND:"legend",TAG_MARKERREF:"marker-ref",TAG_MARKERREFS:"marker-refs",TAG_MARKER_DESCRIPTION:"marker-description",TAG_MARKER_DESCRIPTIONS:"marker-descriptions",TAG_NOTES:"notes",TAG_POSITION:"position",TAG_RELATIONSHIP:"relationship",TAG_RELATIONSHIPS:"relationships",TAG_SHEET:"sheet",TAG_TITLE:"title",TAG_TOPIC:"topic",TAG_TOPICS:"topics",TAG_WORKBOOK:"xmap-content",TOPIC_ATTACHED:"attached",TOPIC_DETACHED:"detached",TOPIC_FLOATING:"floating",TOPIC_PROTOCOL:"xmind:#",TOPIC_ROOT:"root",VAL_FOLDED:"folded",VERSION:"2.0",XMAP:"urn:xmind:xmap:xmlns:content:2.0",XMIND_EXT:".xmind",MAKERIDS:["flag-black","flag-blue","flag-green","flag-orange","flag-purple","flag-red","other-calendar","other-clock","other-coffee-cup","other-email","other-exclam","other-fax","other-lightbulb","other-people","other-phone","other-question","priority-1","priority-2","priority-3","priority-4","priority-5","priority-6","smiley-angry","smiley-boring","smiley-cry","smiley-laugh","smiley-smile","smiley-surprise","task-3quar","task-done","task-half","task-pause","task-quarter","task-start"]}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),u=n(10),a=n(12),s=function(){function e(){r(this,e)}return i(e,[{key:"getAttribute",value:function(e){return this.doc.getAttribute(e)||""}},{key:"setAttribute",value:function(e,t){return this.doc.setAttribute(e,t),this}},{key:"removeAttribute",value:function(e){return this.doc.removeAttribute(e),this}},{key:"eachChildNode",value:function(e,t){a.eachChildNode(this.doc,e,t)}},{key:"findOrCreateChildNode",value:function(e){return a.findOrCreateChildNode(this.doc,e)}},{key:"getModifiedTime",value:function(){return o.toInteger(this.getAttribute(u.ATTR_TIMESTAMP))}},{key:"setModifiedTime",value:function(e){return e=o.isDate(e)?e.getTime():e,o.isNumber(e)||(e=a.getCurrentTimestamp()),this.setAttribute(u.ATTR_TIMESTAMP,e),this}},{key:"getTitle",value:function(){var e=a.findChildNode(this.doc,{tagName:u.TAG_TITLE});return e?e.textContent:""}},{key:"setTitle",value:function(e){var t=a.findOrCreateChildNode(this.doc,{tagName:u.TAG_TITLE});return t.textContent=e,this}},{key:"getPosition",value:function(){var e=a.findChildNode(this.doc,{tagName:u.TAG_POSITION});return e?{x:o.toInteger(e.getAttribute(u.ATTR_X)),y:o.toInteger(e.getAttribute(u.ATTR_Y))}:null}},{key:"setPosition",value:function(e){var t=a.findOrCreateChildNode(this.doc,{tagName:u.TAG_POSITION});return t.setAttribute(u.ATTR_X,e.x),t.setAttribute(u.ATTR_Y,e.y),this}},{key:"removePosition",value:function(){return a.removeChildNode(this.doc,{tagName:u.TAG_POSITION}),this}},{key:"destroy",value:function(){var e=this;e.doc.parentNode.removeChild(e.doc),e.doc=null,e=null}},{key:"toPlainObject",value:function(){return this}},{key:"toJSON",value:function(){return JSON.stringify(this.toPlainObject())}}]),e}();e.exports=s},function(e,t){"use strict";var n={getCurrentTimestamp:function(){return Date.now()},getDefaultSheetName:function(e){return"Sheet "+e},getDefaultTopicName:function(e){return e+" Topic"},uuid:function(e){return(e||"")+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}};e.exports=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),s=n(10),c=n(11),l=n(14),d=n(12),f="visible",p={x:500,y:500},h=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),o=n,u=e.sheet;if(a.extend(o,{sheet:u}),e.doc)o.doc=e.doc;else{var c=e.position||p,h=e.markerDescriptions||[],T=e.visibility||f;o.doc=d.parseFromString(l({visibility:T,markerDescriptions:h,position:c})).documentElement,u.doc.appendChild(o.doc)}return o.markerDescriptionsNode=d.findOrCreateChildNode(o.doc,{tagName:s.TAG_MARKER_DESCRIPTIONS}),u.legend=o,n}return o(t,e),u(t,[{key:"toPlainObject",value:function(){var e=this,t=a.map(d.findChildNodes(e.markerDescriptionsNode,{tagName:s.TAG_MARKER_DESCRIPTION}),function(e){return{markderId:e.getAttribute(s.ATTR_MARKERID),description:e.getAttribute(s.ATTR_DESCRIPTION)}});return{sheetId:e.sheet.id,markerDescriptions:t,position:e.getPosition()||p,visibility:e.getVisibility()||f}}},{key:"addMarkerDescription",value:function(e,t){var n=this,r={};return r[s.ATTR_MARKERID]=e,r[s.ATTR_DESCRIPTION]=t,d.findOrCreateChildNode(n.markerDescriptionsNode,{tagName:s.TAG_MARKER_DESCRIPTION,attributes:r}),n}},{key:"removeMarkerDescription",value:function(e){var t=this,n={};return n[s.ATTR_MARKERID]=e,d.removeChildNode(t.markerDescriptionsNode,{tagName:s.TAG_MARKER_DESCRIPTION,attributes:n}),t}},{key:"getVisibility",value:function(){return this.getAttribute(s.ATTR_VISIBILITY)}},{key:"setVisibility",value:function(e){return this.setAttribute(s.ATTR_VISIBILITY,e),this}}]),t}(c);a.extend(h,{DEFAULT_VISIBILITY:f,DEFAULT_POSITION:p}),e.exports=h},function(e,t,n){"use strict";var r=n(1);e.exports=function(e){e=e||{};var t,n="";Array.prototype.join;return function(e,i,o){return n+='<legend visibility="'+(null==(t=e)?"":t)+'" xmlns:svg="http://www.w3.org/2000/svg"><marker-descriptions>',r.each(i,function(e){n+='<marker-description description="'+(null==(t=e.description)?"":t)+'" marker-id="'+(null==(t=e.id)?"":t)+'"/>'}),n+='</marker-descriptions><position svg:x="'+(null==(t=o.x)?"":t)+'" svg:y="'+(null==(t=o.y)?"":t)+'"/></legend>\n'}(e.visibility,e.markerDescriptions,e.position)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),s=n(10),c=n(11),l=n(16),d=n(12),f="relationship-",p=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),o=n,u=e.sheet;a.extend(o,{sheet:u});var c=d.findOrCreateChildNode(u.doc,{tagName:s.TAG_RELATIONSHIPS});if(u.relationshipsNode=c,e.doc)o.doc=e.doc;else{var p={},h=e.id||d.uuid(f);if(p[s.ATTR_END1]=e.sourceId,p[s.ATTR_END2]=e.targetId,p[s.ATTR_ID]=h,d.findChildNode(c,{tagName:s.TAG_RELATIONSHIP,attributes:p}))throw new Error("the same relationship already exists");o.doc=d.parseFromString(l({id:h,sourceId:e.sourceId,targetId:e.targetId})).documentElement,c.appendChild(o.doc),o.setModifiedTime()}return o.id=o.getAttribute(s.ATTR_ID),a.extend(o,{id:o.getAttribute(s.ATTR_ID),sourceId:o.getAttribute(s.ATTR_END1),targetId:o.getAttribute(s.ATTR_END2)}),e.title&&o.setTitle(e.title),u.relationships=a.union(u.relationships,[o]),u.relationshipById[o.id]=o,n}return o(t,e),u(t,[{key:"toPlainObject",value:function(){var e=this;return{id:e.id,sheetId:e.sheet.id,sourceId:e.getSource(),targetId:e.getTarget(),modifiedTime:e.getModifiedTime(),title:e.getTitle()}}},{key:"getSource",value:function(){return this.getAttribute(s.ATTR_END1)}},{key:"setSource",value:function(e){var t=this,n=t.getTarget();if(n===e)throw new Error("source & target should not be the same");return e?(t.setAttribute(s.ATTR_END1,e),t.setModifiedTime()):t}},{key:"getTarget",value:function(){return this.getAttribute(s.ATTR_END2)}},{key:"setTarget",value:function(e){var t=this,n=t.getSource();if(n===e)throw new Error("source & target should not be the same");return e?(t.setAttribute(s.ATTR_END2,e),t.setModifiedTime()):t}}]),t}(c);e.exports=p},function(e,t,n){"use strict";n(1);e.exports=function(e){e=e||{};var t,n="";Array.prototype.join;return function(e,r,i){return n+='<relationship end1="'+(null==(t=e)?"":t)+'" end2="'+(null==(t=r)?"":t)+'" id="'+(null==(t=i)?"":t)+'"/>\n'}(e.sourceId,e.targetId,e.id)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),s=n(10),c=n(11),l=n(13),d=n(15),f=n(18),p=n(24),h=n(12),T="sheet-",m=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),o=n,u=e.workbook;if(a.extend(o,{legend:null,relationshipById:{},relationships:[],rootTopic:null,topicById:{},topics:[],workbook:u}),e.doc)o.doc=e.doc,o._loadLegend()._loadRootTopic()._loadRelationships();else{if(e.id&&u.sheetById[e.id])throw new Error("sheet id '"+e.id+"' already exists!");o.doc=h.parseFromString(p({id:e.id||h.uuid(T),title:e.title,theme:e.theme})).documentElement,u.doc.appendChild(o.doc),o._addRootTopic({id:e.rootTopicId||h.getDefaultTopicName("Root"),title:e.rootTopicName,styleId:e.rootTopicStyleId}),o.setModifiedTime()}return a.extend(o,{id:o.getAttribute(s.ATTR_ID)}),u.sheets=a.union(u.sheets,[o]),u.sheetById[o.id]=o,n}return o(t,e),u(t,[{key:"destroy",value:function(){var e=this,t=e.workbook;if(t.sheets.length<=1)throw new Error("cannot destroy the last sheet!");a.each(e.topics,function(e){e.destroy(!0)}),a.each(e.relationships,function(e){e.destroy()}),e.legend&&e.legend.destroy(),c.prototype.destroy.apply(e)}},{key:"toPlainObject",value:function(){var e=this;return{id:e.id,theme:e.getTheme(),title:e.getTitle(),modifiedTime:e.getModifiedTime(),rootTopic:e.rootTopic.toPlainObject(),relationships:a.map(e.relationships,function(e){return e.toPlainObject()}),legend:e.legend?e.legend.toPlainObject():null}}},{key:"_loadLegend",value:function(){var e=this,t=h.findChildNodes(e.doc,{tagName:s.TAG_LEGEND})[0];return t&&new l({sheet:e,doc:t}),e}},{key:"_loadRootTopic",value:function(){var e=this,t=h.findChildNode(e.doc,{tagName:s.TAG_TOPIC});return t?new f({sheet:e,doc:t}):e._addRootTopic(),e}},{key:"_loadRelationships",value:function(){var e=this,t=h.findChildNodes(e.doc,{tagName:s.TAG_RELATIONSHIPS})[0];return t&&(e.relationshipsNode=t,a.each(t.childNodes,function(t){new d({sheet:e,doc:t})})),this}},{key:"getTheme",value:function(){return this.getAttribute(s.ATTR_THEME)}},{key:"setTheme",value:function(e){return this.setAttribute(s.ATTR_THEME,e),this.setModifiedTime()}},{key:"getRootTopic",value:function(){return this.rootTopic}},{key:"_addRootTopic",value:function(e){var t=this;return t.rootTopic?t.rootTopic:(e=e||{},a.extend(e,{sheet:t}),t.setModifiedTime(),new f(e))}},{key:"addLegend",value:function(){var e=this;return e.legend?e.legend:(e.setModifiedTime(),new l({sheet:e}))}},{key:"removeLegend",value:function(){var e=this;return e.legend?(e.legend.destroy(),e.legend=null,e.setModifiedTime()):e}},{key:"addMarkerDescription",value:function(e,t){var n=this;return n.legend||n.addLegend(),n.legend.addMarkerDescription(e,t)}},{key:"removeMarkerDescription",value:function(e){var t=this;return t.legend?(t.legend.removeMarkerDescription(e),t):t}},{key:"addRelationship",value:function(e){var t=this;return t.relationshipsNode=h.findOrCreateChildNode(t.doc,{tagName:s.TAG_RELATIONSHIPS}),t.setModifiedTime(),new d({id:e.id,sheet:t,sourceId:e.sourceId,targetId:e.targetId,title:e.title})}},{key:"removeRelationship",value:function(){var e=this,t=a.toArray(arguments),n=void 0;if(1===t.length)n=t[0],n instanceof d||(a.isNumber(n)?n=e.relationships[n]:a.isString(n)&&(n=e.relationshipById[n]));else{var r=t[0],i=t[1],o={};o[s.ATTR_END1]=r,o[s.ATTR_END2]=i;var u=h.findChildNode(e.relationshipsNode,{tagName:s.TAG_RELATIONSHIP,attributes:o});u&&(n=e.relationshipById[u.getAttribute(s.ATTR_ID)])}return n?(delete e.relationshipById[n.id],e.relationships=a.difference(e.relationships,[n]),n.destroy(),e.setModifiedTime()):e}}]),t}(c);e.exports=m},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){var t=new RegExp(c.TOPIC_FLOATING+"$","i");return e.type===c.TOPIC_DETACHED||(e.structure||"").match(t)?c.TOPIC_DETACHED:c.TOPIC_ATTACHED}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),c=n(10),l=n(11),d=n(19),f=n(20),p=n(21),h=n(22),T=n(23),m=n(12),y="topic-",v=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),o=n,u=e.sheet;return s.extend(o,{childById:{},children:[],isRootTopic:!e.parent,parent:e.parent,sheet:u,structure:e.structure,type:e.type}),e.doc?(o.doc=e.doc,o._loadSubTopics()):(o.doc=m.parseFromString(T({id:e.id||m.uuid(y),styleId:e.styleId||"",title:e.title})).documentElement,o.setModifiedTime()),o.id=o.getAttribute(c.ATTR_ID),o._addToParent(),u.topics=s.union(u.topics,[o]),u.topicById[o.id]=o,n}return o(t,e),a(t,[{key:"_addToParent",value:function(e){var t=this,n=t.sheet;if(t.isRootTopic)n.doc.appendChild(t.doc),n.rootTopic=t;else{e=e||t.parent,t.parent=e,t.topicsType=u(t,n);var r=e.doc,i=m.findOrCreateChildNode(r,{tagName:c.TAG_CHILDREN}),o=m.findOrCreateChildNode(i,{tagName:c.TAG_TOPICS,attributes:{type:t.topicsType}});o.appendChild(t.doc),e.children=s.union(e.children,[t]),e.childById[t.id]=t}}},{key:"destroy",value:function(e){var t=this,n=t.sheet;(e||n.rootTopic!==t)&&(s.each(t.children,function(e){e.destroy()}),l.prototype.destroy.apply(t),n.topics=s.difference(n.topics,[t]),delete n.topicById[t.id])}},{key:"toPlainObject",value:function(){var e=this;return{children:s.map(e.children,function(e){return e.toPlainObject()}),hyperlink:e.getHyperlink(),id:e.id,isRootTopic:e.isRootTopic,labels:e.getLabels(),markers:e.getMarkers(),modifiedTime:e.getModifiedTime(),notes:e.getNotes(),parentId:e.parent?e.parent.id:"",sheetId:e.sheet.id,structure:e.structure,title:e.getTitle(),type:e.type}}},{key:"_loadSubTopics",value:function(){var e=this,n=m.findChildNodes(e.doc,{tagName:c.TAG_CHILDREN});return s.each(n,function(n){var r=m.findChildNodes(n,{tagName:c.TAG_TOPICS});s.each(r,function(n){var r=n.getAttribute(c.ATTR_TYPE),i=m.findChildNodes(n,{tagName:c.TAG_TOPIC});s.each(i,function(n){new t({doc:n,parent:e,sheet:e.sheet,type:r})})})}),e}},{key:"getBranch",value:function(){return this.getAttribute(c.ATTR_BRANCH)}},{key:"setBranch",value:function(e){return this.setAttribute(c.ATTR_BRANCH,e),this.setModifiedTime()}},{key:"setBranchFolded",value:function(){return this.setAttribute(c.ATTR_BRANCH,c.VAL_FOLDED),this.setModifiedTime()}},{key:"addChild",value:function(e){var n=this;return n.setModifiedTime(),e instanceof t?(e._addToParent(n),e):new t(s.extend(e,{parent:n,sheet:n.sheet}))}},{key:"removeChild",value:function(e,n){var r=this;return e=t.getTopic(e,r.sheet),e&&(delete r.childById[e.id],r.children=s.difference(r.children,[e]),n||e.destroy()),r.setModifiedTime()}},{key:"isAncestorOf",value:function(e){var n=this;e=t.getTopic(e,n.sheet);for(var r=e;r.parent;){if(r.parent===n)return!0;r=r.parent}return!1}},{key:"moveTo",value:function(e){var n=this;if(e=t.getTopic(e,n.sheet),!e)throw new Error("target topic does not exist");if(n.isRootTopic)throw new Error("cannot move root topic");if(n===e)throw new Error("cannot move to itself");if(n.isAncestorOf(e))throw new Error("cannot move to a child topic");return n.parent.removeChild(n,!0),e.addChild(n),n.setModifiedTime()}},{key:"getNotes",value:function(){var e=m.findChildNode(this.doc,{tagName:c.TAG_NOTES});if(e){var t=m.findChildNode(e,{tagName:c.PLAIN_FORMAT_NOTE});if(t)return t.textContent}return""}},{key:"setNotes",value:function(e){var t=this;if(!s.isString(e))return t;var n=e.split("\n");m.removeChildNode(t.doc,{tagName:c.TAG_NOTES});var r=m.parseFromString(h({lines:n,plainNotes:e})).documentElement;return t.doc.appendChild(r),t.setModifiedTime()}},{key:"getLabels",value:function(){var e=m.findChildNode(this.doc,{tagName:c.TAG_LABELS});return e?s.map(m.findChildNodes(e,{tagName:c.TAG_LABEL}),function(e){return e.textContent}):[]}},{key:"setLabels",value:function(e){var t=this;e=s.isString(e)?s.map(e.split(","),function(e){return e}):s.isArray(e)?e:[e],e=s.map(e,function(e){return s.trim(e)}),m.removeChildNode(t.doc,{tagName:c.TAG_LABELS});var n=m.parseFromString(d({labels:e})).documentElement;return t.doc.appendChild(n),t.setModifiedTime()}},{key:"getHyperlink",value:function(){return this.doc.getAttribute(c.ATTR_HREF)||""}},{key:"setHyperlink",value:function(e){return this.setAttribute(c.ATTR_HREF,e),this.setModifiedTime()}},{key:"removeHyperlink",value:function(){return this.removeAttribute(c.ATTR_HREF),this.setModifiedTime()}},{key:"getMarkers",value:function(){var e=[],t=m.findChildNode(this.doc,{tagName:c.TAG_MARKERREFS});return t&&m.eachChildNode(t,{tagName:c.TAG_MARKERREF},function(t){var n=t.getAttribute(c.ATTR_MARKERID);n&&e.push(n)}),e}},{key:"setMarkers",value:function(e){var t=this;if(!s.isArray(e))return t;e=s.uniq(e),m.removeChildNode(t.doc,{tagName:c.TAG_MARKERREFS});var n=m.parseFromString(p({markers:e})).documentElement;return t.doc.appendChild(n),t.setModifiedTime()}},{key:"addMarker",value:function(e){var t=this,n=m.findOrCreateChildNode(t.doc,{tagName:c.TAG_MARKERREFS}),r={};if(r[c.ATTR_MARKERID]=e,m.findChildNode(t.doc,{tagName:c.TAG_MARKERREF,attributes:r}))throw new Error("marker already exists!");var i=m.parseFromString(f({id:e})).documentElement;return n.appendChild(i),t.setModifiedTime()}},{key:"removeMarker",value:function(e){var t=this,n=m.findOrCreateChildNode(t.doc,{tagName:c.TAG_MARKERREFS}),r={};return r[c.ATTR_MARKERID]=e,m.removeChildNode(n,{tagName:c.TAG_MARKERREF,attributes:r}),t.setModifiedTime()}}]),t}(l);s.extend(v,{getTopic:function(e,t){return s.isString(e)?e=t.topicById[e]:e instanceof v||(e=null),e}}),e.exports=v},function(e,t,n){"use strict";var r=n(1);e.exports=function(e){e=e||{};var t,n="";Array.prototype.join;return function(e){return n+="<labels>",r.each(e,function(e){n+="<label>"+(null==(t=e)?"":t)+"</label>"}),n+="</labels>\n"}(e.labels)}},function(e,t,n){"use strict";n(1);e.exports=function(e){e=e||{};var t,n="";Array.prototype.join;return function(e){return n+='<marker-ref marker-id="'+(null==(t=e)?"":t)+'"/>\n'}(e.id)}},function(e,t,n){"use strict";var r=n(1);e.exports=function(e){e=e||{};var t,n="";Array.prototype.join;return function(e){return n+="<marker-refs>",r.each(e,function(e){n+='<marker-ref marker-id="'+(null==(t=e)?"":t)+'"/>'}),n+="</marker-refs>\n\n"}(e.markers)}},function(e,t,n){"use strict";var r=n(1);e.exports=function(e){e=e||{};var t,n="";Array.prototype.join;return function(e,i){return n+="<notes><html>",r.each(e,function(e){n+="<xhtml:p>"+(null==(t=e)?"":t)+"</xhtml:p>"}),n+='<!--styles are not supported yet {--><!--<xhtml:p>--><!--<xhtml:span style-id="67gllifq4r1g91gks0tdif9dou">what</xhtml:span>--><!--</xhtml:p>--><!--}--></html><plain>'+(null==(t=i)?"":t)+"</plain></notes>\n"}(e.lines,e.plainNotes)}},function(e,t,n){"use strict";n(1);e.exports=function(e){e=e||{};var t,n="";Array.prototype.join;return function(e,r,i){return n+='<topic id="'+(null==(t=e)?"":t)+'" ',r&&(n+='style-id="'+(null==(t=r)?"":t)+'"'),n+="><title>"+(null==(t=i)?"":t)+"</title></topic>\n"}(e.id,e.styleId,e.title)}},function(e,t,n){"use strict";n(1);e.exports=function(e){e=e||{};var t,n="";Array.prototype.join;return function(e,r,i){return n+='<sheet id="'+(null==(t=e)?"":t)+'" ',r&&(n+='theme="'+(null==(t=r)?"":t)+'"'),n+="><title>"+(null==(t=i)?"":t)+"</title></sheet>\n"}(e.id,e.theme,e.title)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r);
}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(26),s=n(1),c=n(10),l=n(11),d=n(17),f=n(27),p=n(28),h=n(29),T=n(30),m=n(12),y=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),o=n,u=m.getDefaultSheetName(1),a=m.getDefaultTopicName("Root");return e=e||{},s.extend(o,{attachments:e.attachments||{},sheetById:{},sheets:[]}),e.doc?(o.doc=e.doc,o.stylesDoc=e.stylesDoc,o._loadSheets()):(o.doc=m.parseFromString(f({timestamp:m.getCurrentTimestamp()})).documentElement,o.stylesDoc=m.parseFromString(T()).documentElement,o.addSheet({id:e.firstSheetId,rootTopicId:e.rootTopicId,rootTopicName:e.rootTopicName||a,title:e.firstSheetName||u}),o.setModifiedTime()),n}return o(t,e),u(t,[{key:"_loadSheets",value:function(){var e=this;m.eachChildNode(e.doc,{tagName:c.TAG_SHEET},function(t){new d({doc:t,workbook:e})})}},{key:"getPrimarySheet",value:function(){return this.sheets[0]}},{key:"addSheet",value:function(e){var t=this;return e=e||{},t.setModifiedTime(),s.extend(e,{title:e.title||m.getDefaultSheetName(),workbook:t}),new d(e)}},{key:"moveSheet",value:function(e,t){var n=this,r=n.doc,i=n.sheets[e],o=n.sheets[t];return i&&o&&(r.removeChild(i.doc),r.insertBefore(i.doc,o.doc),s.remove(n.sheets,e),n.sheets.splice(t,0,i)),n.setModifiedTime()}},{key:"removeSheet",value:function(e){var t=this;if(t.sheets.length<=1)return t;s.isNumber(e)?e=t.sheets[e]:s.isString(e)&&(e=t.sheetById[e]);var n=s.indexOf(t.sheets,e),r=e.id;return e.destroy(),delete t.sheetById[r],s.remove(t.sheets,n),t.setModifiedTime()}},{key:"destroy",value:function(){}},{key:"toPlainObject",value:function(){var e=this;return{modifiedTime:e.getModifiedTime(),sheets:s.map(e.sheets,function(e){return e.toPlainObject()})}}},{key:"dump",value:function(){var e=this,t=e.zip?e.zip:new a;return t.file(c.CONTENT_XML,m.serializeToString(e.doc)),t.file(c.STYLES_XML,m.serializeToString(e.stylesDoc)),t.file(c.META_XML,h()),t.file(c.MANIFEST_XML,p()),s.forIn(e.attachments,function(e,n){t.file(c.ATTACHMENTS_DIR+n,e)}),e.zip=t,t}}]),t}(l);s.extend(y,{load:function(e){var t=new a(e),n={},r=void 0,i=void 0;if(s.forIn(t.files,function(e,o){if(o=o.replace(/^\//,""),o===c.CONTENT_XML)r=m.parseFromString(t.file(o).asText()).documentElement;else if(o===c.STYLES_XML)i=m.parseFromString(t.file(o).asText()).documentElement;else if(0===o.indexOf(c.ATTACHMENTS_DIR)){var u=o.replace(c.ATTACHMENTS_DIR,"");n[u]=t.file(o).asText()}}),!r)throw new Error("invalid xmind file");var o=new y({attachments:n,doc:r,stylesDoc:i});return o.zip=t,o}}),e.exports=y},function(e,t){e.exports=n},function(e,t,n){"use strict";n(1);e.exports=function(e){e=e||{};var t="";Array.prototype.join;return function(){return t+='<?xml version="1.0" encoding="UTF-8" standalone="no"?><xmap-content xmlns="urn:xmind:xmap:xmlns:content:2.0" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xlink="http://www.w3.org/1999/xlink" version="2.0"></xmap-content>\n'}()}},function(e,t,n){"use strict";n(1);e.exports=function(e){e=e||{};var t="";Array.prototype.join;return function(){return t+='<?xml version="1.0" encoding="UTF-8" standalone="no"?><manifest xmlns="urn:xmind:xmap:xmlns:manifest:1.0"><file-entry full-path="content.xml" media-type="text/xml"/><file-entry full-path="META-INF/" media-type=""/><file-entry full-path="META-INF/manifest.xml" media-type="text/xml"/><file-entry full-path="styles.xml" media-type=""/><file-entry full-path="Thumbnails/" media-type=""/><file-entry full-path="Thumbnails/thumbnail.jpg" media-type="image/jpeg"/></manifest>\n'}()}},function(e,t,n){"use strict";n(1);e.exports=function(e){e=e||{};var t="";Array.prototype.join;return function(){return t+='<?xml version="1.0" encoding="UTF-8" standalone="no"?><meta xmlns="urn:xmind:xmap:xmlns:meta:2.0" version="2.0"/>\n'}()}},function(e,t,n){"use strict";n(1);e.exports=function(e){e=e||{};var t="";Array.prototype.join;return function(){return t+='<?xml version="1.0" encoding="UTF-8" standalone="no"?><xmap-styles xmlns="urn:xmind:xmap:xmlns:style:2.0" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:svg="http://www.w3.org/2000/svg" version="2.0"><automatic-styles></automatic-styles><master-styles></master-styles><styles></styles></xmap-styles>\n'}()}}])});